<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Copula Modeling • univariateML</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Copula Modeling">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">univariateML</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.5.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/copula.html">Copula Modeling</a></li>
    <li><a class="dropdown-item" href="../articles/distributions.html">Distributions</a></li>
    <li><a class="dropdown-item" href="../articles/overview.html">Overview of univariateML</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/JonasMoss/univariateML/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Copula Modeling</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/JonasMoss/univariateML/blob/master/vignettes/copula.Rmd" class="external-link"><code>vignettes/copula.Rmd</code></a></small>
      <div class="d-none name"><code>copula.Rmd</code></div>
    </div>

    
    
<p>This vignette shows how to model multivariate distributions with <a href="https://en.wikipedia.org/wiki/Copula_(probability_theory)" class="external-link">copulas</a>
using <code>univariateML</code> and the <code>copula</code> package.</p>
<p>A <strong>copula</strong> is a function describing the dependency
among a set of one-dimensional distributions. If both the marginal
distributions and the copula is known, the entire multivariate
distribution is known too.</p>
<p>Suppose we look at a multivariate distribution as the pair of a
copula and its marginals. Then a natural model selection method is
to</p>
<ol style="list-style-type: decimal">
<li>Select the marginal distributions using the <a href="https://en.wikipedia.org/wiki/Akaike_information_criterion" class="external-link">AIC</a>.</li>
<li>Select a copula using the marginal data transformed to the unit
interval, again using the AIC.</li>
</ol>
<p>This two-step procedure is commonly used due to its simplicity. The
procedure must be carried out this order since the marginal data cannot
be transformed to the unit interval unless we know the marginal
distributions.</p>
<p>The <code>univariateML</code> can be used for task 1, while the
<code>copula</code> package can be used to do task 2.</p>
<div class="section level2">
<h2 id="abalone-data">Abalone data<a class="anchor" aria-label="anchor" href="#abalone-data"></a>
</h2>
<p>The <code>abalone</code> data set is included in this package. It
consists of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>9</mn><annotation encoding="application/x-tex">9</annotation></semantics></math>
physical measurements of
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>4177</mn><annotation encoding="application/x-tex">4177</annotation></semantics></math>
sea snails.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="st"><a href="https://github.com/JonasMoss/univariateML" class="external-link">"univariateML"</a></span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">abalone</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##   sex length diameter height whole_weight shucked_weight viscera_weight</span></span>
<span><span class="co">## 1   M  0.455    0.365  0.095       0.5140         0.2245         0.1010</span></span>
<span><span class="co">## 2   M  0.350    0.265  0.090       0.2255         0.0995         0.0485</span></span>
<span><span class="co">## 3   F  0.530    0.420  0.135       0.6770         0.2565         0.1415</span></span>
<span><span class="co">## 4   M  0.440    0.365  0.125       0.5160         0.2155         0.1140</span></span>
<span><span class="co">## 5   I  0.330    0.255  0.080       0.2050         0.0895         0.0395</span></span>
<span><span class="co">## 6   I  0.425    0.300  0.095       0.3515         0.1410         0.0775</span></span>
<span><span class="co">##   shell_weight rings</span></span>
<span><span class="co">## 1        0.150    15</span></span>
<span><span class="co">## 2        0.070     7</span></span>
<span><span class="co">## 3        0.210     9</span></span>
<span><span class="co">## 4        0.155    10</span></span>
<span><span class="co">## 5        0.055     7</span></span>
<span><span class="co">## 6        0.120     8</span></span></code></pre>
<p>Following <span class="citation">Ko, Hjort, and Hobæk Haff
(2019)</span> we will take a look at four measurements of the abalones,
namely <code>diameter</code>, <code>height</code>,
<code>shell_weight</code> and <code>age</code>. The variable
<code>age</code> is not present in the <code>abalone</code> data, but is
defined as <code>age = rings + 1.5</code>. Moreover, there are two
outliers in the <code>height</code> data at at
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>1.13</mn><annotation encoding="application/x-tex">1.13</annotation></semantics></math>
and
<math display="inline" xmlns="http://www.w3.org/1998/Math/MathML"><semantics><mn>0.52</mn><annotation encoding="application/x-tex">0.52</annotation></semantics></math>.
We will remove these outliers and all columns we don’t need in the
following.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">data</span> <span class="op">&lt;-</span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">abalone</span>, <span class="va">height</span> <span class="op">&lt;</span> <span class="fl">0.5</span><span class="op">)</span></span>
<span><span class="va">data</span><span class="op">$</span><span class="va">age</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">$</span><span class="va">rings</span> <span class="op">+</span> <span class="fl">1.5</span></span>
<span><span class="va">data</span> <span class="op">&lt;-</span> <span class="va">data</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"diameter"</span>, <span class="st">"height"</span>, <span class="st">"shell_weight"</span>, <span class="st">"age"</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/hist.html" class="external-link">hist</a></span><span class="op">(</span><span class="va">data</span><span class="op">$</span><span class="va">height</span>, main <span class="op">=</span> <span class="st">"Abalone height"</span>, xlab <span class="op">=</span> <span class="st">"Height in mm"</span><span class="op">)</span></span></code></pre></div>
<p><img src="copula_files/figure-html/make_data-1.png" width="576"></p>
<p>Let’s continue doing step 1. First we must decide on a set of models
to try out.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">models</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span></span>
<span>  <span class="st">"gumbel"</span>, <span class="st">"laplace"</span>, <span class="st">"logis"</span>, <span class="st">"norm"</span>, <span class="st">"exp"</span>, <span class="st">"gamma"</span>,</span>
<span>  <span class="st">"invgamma"</span>, <span class="st">"invgauss"</span>, <span class="st">"invweibull"</span>, <span class="st">"llogis"</span>, <span class="st">"lnorm"</span>,</span>
<span>  <span class="st">"rayleigh"</span>, <span class="st">"weibull"</span>, <span class="st">"lgamma"</span>, <span class="st">"pareto"</span>, <span class="st">"beta"</span>, <span class="st">"kumar"</span>,</span>
<span>  <span class="st">"logitnorm"</span></span>
<span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/length.html" class="external-link">length</a></span><span class="op">(</span><span class="va">models</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] 18</span></span></code></pre>
<p>Optionally, we can use all implemented models with</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">univariateML_models</span></span></code></pre></div>
<pre><code><span><span class="co">##  [1] "beta"       "betapr"     "binom"      "cauchy"     "exp"       </span></span>
<span><span class="co">##  [6] "gamma"      "ged"        "geom"       "gumbel"     "invgamma"  </span></span>
<span><span class="co">## [11] "invgauss"   "invweibull" "kumar"      "laplace"    "lgamma"    </span></span>
<span><span class="co">## [16] "lgser"      "llogis"     "lnorm"      "logis"      "logitnorm" </span></span>
<span><span class="co">## [21] "lomax"      "naka"       "nbinom"     "norm"       "pareto"    </span></span>
<span><span class="co">## [26] "pois"       "power"      "rayleigh"   "sged"       "snorm"     </span></span>
<span><span class="co">## [31] "sstd"       "std"        "unif"       "weibull"    "zip"       </span></span>
<span><span class="co">## [36] "zipf"</span></span></code></pre>
<p>The next step is to fit all models, compute the AIC, and select the
best model. This is exactly what <code><a href="../reference/model_select.html">model_select()</a></code> does.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">margin_fits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">model_select</span>, models <span class="op">=</span> <span class="va">models</span>, criterion <span class="op">=</span> <span class="st">"aic"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Loading required package: intervals</span></span></code></pre>
<p>Now we use the <code>fitCopula</code> from the package
<code>copula</code> on the transformed margins of
<code>abalone</code>.</p>
<p>We will examine two elliptical copulas and three Archimedean copulas.
The elliptical copulas are the Gaussian copula and the
<em>t</em>-copula, while the Archimedean copulas are the Joe copula, the
Clayton copula, and the Gumbel copula.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Transform the marginals to the unit interval.</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_along</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>, \<span class="op">(</span><span class="va">j</span><span class="op">)</span> <span class="fu"><a href="../reference/MaximumLikelihoodDistribution.html">pml</a></span><span class="op">(</span><span class="va">data</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span>, <span class="va">margin_fits</span><span class="op">[[</span><span class="va">j</span><span class="op">]</span><span class="op">]</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># The copulas described above.</span></span>
<span><span class="va">copulas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span></span>
<span>  normal <span class="op">=</span> <span class="fu">copula</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/copula/man/ellipCopula.html" class="external-link">normalCopula</a></span><span class="op">(</span>dim <span class="op">=</span> <span class="fl">4</span>, dispstr <span class="op">=</span> <span class="st">"un"</span><span class="op">)</span>,</span>
<span>  t <span class="op">=</span> <span class="fu">copula</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/copula/man/ellipCopula.html" class="external-link">tCopula</a></span><span class="op">(</span>dim <span class="op">=</span> <span class="fl">4</span>, dispstr <span class="op">=</span> <span class="st">"un"</span><span class="op">)</span>,</span>
<span>  joe <span class="op">=</span> <span class="fu">copula</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/copula/man/archmCopula.html" class="external-link">joeCopula</a></span><span class="op">(</span>dim <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>  clayton <span class="op">=</span> <span class="fu">copula</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/copula/man/archmCopula.html" class="external-link">claytonCopula</a></span><span class="op">(</span>dim <span class="op">=</span> <span class="fl">4</span><span class="op">)</span>,</span>
<span>  gumbel <span class="op">=</span> <span class="fu">copula</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/copula/man/archmCopula.html" class="external-link">gumbelCopula</a></span><span class="op">(</span>dim <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="va">fits</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span></span>
<span>  <span class="va">copulas</span>,</span>
<span>  \<span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu">copula</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/copula/man/fitCopula.html" class="external-link">fitCopula</a></span><span class="op">(</span><span class="va">x</span>, data <span class="op">=</span> <span class="va">y</span>, method <span class="op">=</span> <span class="st">"mpl"</span><span class="op">)</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">sapply</a></span><span class="op">(</span><span class="va">fits</span>, <span class="va">AIC</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##     normal          t        joe    clayton     gumbel </span></span>
<span><span class="co">## -21822.309 -23152.657  -8668.457 -16502.422 -12821.817</span></span></code></pre>
<p>The <em>t</em>-copula is the clear winner of the AIC competition. The
Archimedean copulas perform particularly poorly.</p>
<p>Hence our final model is the <em>t</em>-copula with Kumaraswamy
(<code>mlkumar</code>) marginal distribution for <code>diameter</code>,
normal marginal distribution for <code>height</code>, Weibull marginal
distribution for <code>shell_weight</code>, and log normal marginal
distribution for <code>age</code>.</p>
</div>
<div class="section level2 unnumbered">
<h2 class="unnumbered" id="references">References<a class="anchor" aria-label="anchor" href="#references"></a>
</h2>
<div id="refs" class="references csl-bib-body hanging-indent" entry-spacing="0">
<div id="ref-ko2019focused" class="csl-entry">
Ko, Vinnie, Nils Lid Hjort, and Ingrid Hobæk Haff. 2019. <span>“Focused
Information Criteria for Copulas.”</span> <em>Scandinavian Journal of
Statistics</em>.
</div>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jonas Moss.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
