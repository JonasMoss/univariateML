<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Copula Modeling • univariateML</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha256-916EbMg70RQy9LHiGkXzG8hSg9EdNy97GazNG/aiY1w=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/all.min.css" integrity="sha256-nAmazAk6vS34Xqo0BSrTb+abbtFlgsFK7NKSi6o7Y78=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.7.1/css/v4-shims.min.css" integrity="sha256-6qHlizsOWFskGlwVOKuns+D1nB6ssZrHQrNj1wGplHc=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/headroom.min.js" integrity="sha256-DJFC1kqIhelURkuza0AvYal5RxMtpzLjFhsnVIeuk+U=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.9.4/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Copula Modeling">
<meta property="og:description" content="">
<meta property="og:image" content="/logo.png">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">univariateML</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/copula.html">Copula Modeling</a>
    </li>
    <li>
      <a href="../articles/distributions.html">Distributions</a>
    </li>
    <li>
      <a href="../articles/overview.html">Overview of univariateML</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/JonasMoss/univariateML">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>Copula Modeling</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/JonasMoss/univariateML/blob/master/vignettes/copula.Rmd"><code>vignettes/copula.Rmd</code></a></small>
      <div class="hidden name"><code>copula.Rmd</code></div>

    </div>

    
    
<p>This vignette shows how to model multivariate distributions with <a href="https://en.wikipedia.org/wiki/Copula_(probability_theory)">copulas</a> using <code>univariateML</code> and the <code>copula</code> package.</p>
<p>A <strong>copula</strong> is a function describing the dependency among a set of one-dimensional distributions. If both the marginal distributions and the copula is know, the entire multivariate distribution is known too.</p>
<p>Suppose we look at a multivariate distribution as the pair of a copula and its marginals. Then a natural model selection using is to</p>
<p>1.) select the marginal distributions using the <a href="https://en.wikipedia.org/wiki/Akaike_information_criterion">AIC</a>; 2.) select a copula using the marginal data transformed to the unit interval, again using the AIC.</p>
<p>This two-step procedure is commonly used due to its simplicity. The procedure must be carried out this order since the marginal data cannot be transformed to the unit interval unless we know the marginal distributions.</p>
<p>The <code>univariateML</code> can be used to speed up task 1, while the <code>copula</code> package can be used to do task 2.</p>
<div id="abalone-data" class="section level2">
<h2 class="hasAnchor">
<a href="#abalone-data" class="anchor"></a>Abalone data</h2>
<p>The <code>abalone</code> data set is included in this package. It consists of <span class="math inline">\(9\)</span> physical measurements of <span class="math inline">\(4177\)</span> sea snails.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb1-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="st">"univariateML"</span>)</a>
<a class="sourceLine" id="cb1-2" title="2"><span class="kw"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(abalone)</a></code></pre></div>
<pre><code>##   sex length diameter height whole_weight shucked_weight viscera_weight
## 1   M  0.455    0.365  0.095       0.5140         0.2245         0.1010
## 2   M  0.350    0.265  0.090       0.2255         0.0995         0.0485
## 3   F  0.530    0.420  0.135       0.6770         0.2565         0.1415
## 4   M  0.440    0.365  0.125       0.5160         0.2155         0.1140
## 5   I  0.330    0.255  0.080       0.2050         0.0895         0.0395
## 6   I  0.425    0.300  0.095       0.3515         0.1410         0.0775
##   shell_weight rings
## 1        0.150    15
## 2        0.070     7
## 3        0.210     9
## 4        0.155    10
## 5        0.055     7
## 6        0.120     8</code></pre>
<p>Following <span class="citation">Ko, Hjort, and Hobæk Haff (2019)</span> we will take a look at four measurements of the abalones, namely <code>diameter</code>, <code>height</code>, <code>shell_weight</code> and <code>age</code>. The variable <code>age</code> is not present in the <code>abalone</code> data, but is defined as <code>age = rings + 1.5</code>. Moreover, there are two outliers in the <code>height</code> data at at <span class="math inline">\(1.13\)</span> and <span class="math inline">\(0.52\)</span>. We will remove these outliers.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb3-1" title="1">data =<span class="st"> </span>dplyr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/dplyr/man/filter.html">filter</a></span>(abalone, height <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.5</span>)</a>
<a class="sourceLine" id="cb3-2" title="2">data<span class="op">$</span>age =<span class="st"> </span>data<span class="op">$</span>rings <span class="op">+</span><span class="st"> </span><span class="fl">1.5</span></a>
<a class="sourceLine" id="cb3-3" title="3"><span class="kw"><a href="https://rdrr.io/r/graphics/hist.html">hist</a></span>(data<span class="op">$</span>height, <span class="dt">main =</span><span class="st">" Abalone height"</span>, <span class="dt">xlab =</span> <span class="st">"Height in mm"</span>)</a></code></pre></div>
<p><img src="copula_files/figure-html/make_data-1.png" width="576"></p>
<p>Let’s continue doing step 1. First we must decide on a set of models to try out.</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb4-1" title="1">models =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"mlgumbel"</span>, <span class="st">"mllaplace"</span>, <span class="st">"mllogis"</span>, <span class="st">"mlnorm"</span>, <span class="st">"mlexp"</span>, <span class="st">"mlgamma"</span>, </a>
<a class="sourceLine" id="cb4-2" title="2">             <span class="st">"mlinvgamma"</span>, <span class="st">"mlinvgauss"</span>, <span class="st">"mlinvweibull"</span>, <span class="st">"mlllogis"</span>, <span class="st">"mllnorm"</span>, </a>
<a class="sourceLine" id="cb4-3" title="3">             <span class="st">"mlrayleigh"</span>, <span class="st">"mlweibull"</span>, <span class="st">"mllgamma"</span>, <span class="st">"mlpareto"</span>, <span class="st">"mlbeta"</span>, <span class="st">"mlkumar"</span>,</a>
<a class="sourceLine" id="cb4-4" title="4">             <span class="st">"mllogitnorm"</span>)</a>
<a class="sourceLine" id="cb4-5" title="5"><span class="kw"><a href="https://rdrr.io/r/base/length.html">length</a></span>(models)</a></code></pre></div>
<pre><code>## [1] 18</code></pre>
<p>The nest step is to define a function that calculates the AIC for all our candidate models over every margin.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb6-1" title="1"><span class="co">#' Calculate AICs for a column </span></a>
<a class="sourceLine" id="cb6-2" title="2"><span class="co">#' @param variable The variable to calculate AICs for.</span></a>
<a class="sourceLine" id="cb6-3" title="3"><span class="co">#' @return A named vector of AICs.</span></a>
<a class="sourceLine" id="cb6-4" title="4"></a>
<a class="sourceLine" id="cb6-5" title="5">AICs =<span class="st"> </span><span class="cf">function</span>(variable) {</a>
<a class="sourceLine" id="cb6-6" title="6">  x =<span class="st"> </span>data[[variable]]</a>
<a class="sourceLine" id="cb6-7" title="7">  FUN =<span class="st"> </span><span class="cf">function</span>(name, <span class="dt">x =</span> <span class="ot">NULL</span>) <span class="kw"><a href="https://rdrr.io/r/base/conditions.html">tryCatch</a></span>(<span class="dt">expr =</span> <span class="kw"><a href="https://rdrr.io/r/base/eval.html">eval</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/call.html">call</a></span>(name, x)), </a>
<a class="sourceLine" id="cb6-8" title="8">                                                 <span class="dt">error =</span> <span class="cf">function</span>(e) <span class="ot">NULL</span>)</a>
<a class="sourceLine" id="cb6-9" title="9">  fits =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/funprog.html">Filter</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/funprog.html">Negate</a></span>(is.null), <span class="kw"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="dt">X =</span> models, <span class="dt">FUN =</span> FUN, <span class="dt">x =</span> x))</a>
<a class="sourceLine" id="cb6-10" title="10">  <span class="kw"><a href="https://rdrr.io/r/base/sort.html">sort</a></span>(<span class="kw"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(fits, AIC))</a>
<a class="sourceLine" id="cb6-11" title="11">}</a></code></pre></div>
<p>This function returns a vector of AICs for each model where <code>ml***</code> didn’t fail. When it fails it is since the support of the data doesn’t not match the density, e.g. when <code>-1</code> is fed to the exponential density.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb7-1" title="1"><span class="kw">AICs</span>(<span class="st">"age"</span>)</a></code></pre></div>
<pre><code>##      mllnorm     mlgumbel   mlinvgauss     mllgamma      mlgamma 
##     21033.17     21039.99     21055.60     21100.20     21104.82 
##   mlinvgamma      mllogis    mllaplace       mlnorm    mlweibull 
##     21107.62     21295.85     21310.76     21627.91     21893.36 
## mlinvweibull   mlrayleigh        mlexp     mlpareto     mlllogis 
##     22050.05     23860.54     28697.63     31678.23    394429.50</code></pre>
<p>But we are most interested in the models with smallest AICs.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb9-1" title="1"><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(<span class="dt">X =</span> <span class="kw"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"diameter"</span>, <span class="st">"height"</span>, <span class="st">"shell_weight"</span>, <span class="st">"age"</span>), </a>
<a class="sourceLine" id="cb9-2" title="2">       <span class="dt">FUN =</span> <span class="cf">function</span>(x) <span class="kw"><a href="https://rdrr.io/r/base/names.html">names</a></span>(<span class="kw">AICs</span>(x))[<span class="dv">1</span>])</a></code></pre></div>
<pre><code>##     diameter       height shell_weight          age 
##    "mlkumar"     "mlnorm"  "mlweibull"    "mllnorm"</code></pre>
<p>Now we use the <code>fitCopula</code> from the package <code>copula</code> on the transformed margins of <code>abalone</code>.</p>
<p>We will examine two elliptical copulas and three Archimedean copulas. The elliptical copulas are the Gaussian copula and the <em>t</em>-copula, while the Archimedean copulas are the Joe copula, the Clayton copula, and the Gumbel copula.</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb11-1" title="1"><span class="co"># Transform the marginals to the unit interval.</span></a>
<a class="sourceLine" id="cb11-2" title="2">y =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/matrix.html">as.matrix</a></span>(dplyr<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html">transmute</a></span>(data, </a>
<a class="sourceLine" id="cb11-3" title="3">                     <span class="dt">diameter =</span> <span class="kw"><a href="../reference/MaximumLikelihoodDistribution.html">pml</a></span>(diameter, <span class="kw"><a href="../reference/mlkumar.html">mlkumar</a></span>(diameter)),</a>
<a class="sourceLine" id="cb11-4" title="4">                     <span class="dt">height =</span> <span class="kw"><a href="../reference/MaximumLikelihoodDistribution.html">pml</a></span>(height, <span class="kw"><a href="../reference/mlnorm.html">mlnorm</a></span>(height)),</a>
<a class="sourceLine" id="cb11-5" title="5">                     <span class="dt">shell_weight =</span> <span class="kw"><a href="../reference/MaximumLikelihoodDistribution.html">pml</a></span>(shell_weight, <span class="kw"><a href="../reference/mlweibull.html">mlweibull</a></span>(shell_weight)),</a>
<a class="sourceLine" id="cb11-6" title="6">                     <span class="dt">age =</span> <span class="kw"><a href="../reference/MaximumLikelihoodDistribution.html">pml</a></span>(age, <span class="kw"><a href="../reference/mllnorm.html">mllnorm</a></span>(rings))))</a>
<a class="sourceLine" id="cb11-7" title="7"></a>
<a class="sourceLine" id="cb11-8" title="8"><span class="co"># The copulas described above.</span></a>
<a class="sourceLine" id="cb11-9" title="9">copulas =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="dt">normal =</span> copula<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/copula/man/ellipCopula.html">normalCopula</a></span>(<span class="dt">dim =</span> <span class="dv">4</span>, <span class="dt">dispstr =</span> <span class="st">"un"</span>),</a>
<a class="sourceLine" id="cb11-10" title="10">               <span class="dt">t =</span> copula<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/copula/man/ellipCopula.html">tCopula</a></span>(<span class="dt">dim =</span> <span class="dv">4</span>, <span class="dt">dispstr =</span> <span class="st">"un"</span>),</a>
<a class="sourceLine" id="cb11-11" title="11">               <span class="dt">joe =</span> copula<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/copula/man/archmCopula.html">joeCopula</a></span>(<span class="dt">dim =</span> <span class="dv">4</span>),</a>
<a class="sourceLine" id="cb11-12" title="12">               <span class="dt">clayton =</span> copula<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/copula/man/archmCopula.html">claytonCopula</a></span>(<span class="dt">dim =</span> <span class="dv">4</span>),</a>
<a class="sourceLine" id="cb11-13" title="13">               <span class="dt">gumbel =</span> copula<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/copula/man/archmCopula.html">gumbelCopula</a></span>(<span class="dt">dim =</span> <span class="dv">4</span>))</a>
<a class="sourceLine" id="cb11-14" title="14"></a>
<a class="sourceLine" id="cb11-15" title="15">fits =<span class="st"> </span><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(copulas,</a>
<a class="sourceLine" id="cb11-16" title="16">              <span class="cf">function</span>(x) copula<span class="op">::</span><span class="kw"><a href="https://rdrr.io/pkg/copula/man/fitCopula.html">fitCopula</a></span>(x, <span class="dt">data =</span> y, <span class="dt">method =</span> <span class="st">"mpl"</span>))</a>
<a class="sourceLine" id="cb11-17" title="17"></a>
<a class="sourceLine" id="cb11-18" title="18"><span class="kw"><a href="https://rdrr.io/r/base/lapply.html">sapply</a></span>(fits, AIC)</a></code></pre></div>
<pre><code>##    normal         t       joe   clayton    gumbel 
## -20776.28 -21856.69 -10139.89 -14546.95 -13586.67</code></pre>
<p>The <em>t</em>-copula is the clear winner of the AIC competition. The Archimedean copulas perform particularly poorly.</p>
<p>Hence our final model is the <em>t</em>-copula with Kumaraswamy (<code>mlkumar</code>) marginal distribution for <code>diameter</code>, normal marginal distribution for <code>height</code>, Weibull marginal distribution for <code>shell_weight</code>, and log normal marginal distribution for <code>age</code>.</p>
</div>
<div id="references" class="section level2 unnumbered">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
<div id="refs" class="references">
<div id="ref-ko2019focused">
<p>Ko, Vinnie, Nils Lid Hjort, and Ingrid Hobæk Haff. 2019. “Focused Information Criteria for Copulas.” <em>Scandinavian Journal of Statistics</em>.</p>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#abalone-data">Abalone data</a></li>
      <li><a href="#references">References</a></li>
      </ul>
</div>
      </div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://burnishedmossite.netlify.com">Jonas Moss</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.4.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
